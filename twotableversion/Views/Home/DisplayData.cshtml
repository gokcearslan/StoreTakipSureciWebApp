@using twotableversion.Data

@{
    ViewData["Title"] = "Display Data";}



<h1 style="color:#FCB000;">@*Selected Takvim: @ViewBag.SelectedTakvimId*@</h1>

<h1 style="color: #FCB000;">@*Selected Uygulama:*@ @ViewBag.SelectedUygulamaAdi , @ViewBag.SelectedTakvimId </h1>



<input type="text" id="searchInput" placeholder="Search">
<button onclick="searchInTable()" style="background-color: #FFCA4F; color: white;">Search</button>


<a href="/Home/Save" style="color:#e68a06;  margin-top:10px; margin-left:50px;">Yeni satır ekle</a>



@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}


@*

<div style="margin-top: 20px;">
    <strong>Version:</strong> @item.version
</div>


<table class="table">
    <thead>
    </thead>
    <tbody>
        <tr>
            <td>Version: @Model[0].Version</td>
        </tr>
    </tbody>
</table>
*@




<table class="table" style="border-block-color:#FCB000">
    <thead>
        <tr>
           @* <th>Uygulama Adı</th>
            <th>Takvim Id</th>*@

            <th>Version</th>
            <th >Etki Alanı</th>
            <th>Talep/Bug</th>
            <th>Talep Adı</th>
            <th>Bulgu Durumu</th>
            <th>Segment</th>
            <th>KKTYE Gönderildi mi?</th>
            <th>KKTE Onayı Alındı mı?</th>
            <th>Notlar</th>
            <th>İlgili Analist</th>
            <th>Merge Durumu IOS</th>
            <th>Merge Durumu AND</th>
            <th>Merge Durumu BE</th>
            <th>İlgili IOS Developer</th>
            <th>İlgili Android Developer</th>
            <th>İlgili BE Developer</th>
            <th>BE Taşıma Katmanları</th>
            <th>Geçiş Zorunluluğu </th>
            <th>UI/API Senaryo ID</th>
            <th>İşlem</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
               @* <td>@item.UygulamaAdı</td>
                <td>@item.TakvimId</td>*@


                <td>@item.Version</td>
                <td>@item.EtkiAlanı</td>
                <td>@item.TalepBug</td>
                <td>@item.TalepAdı</td>
                <td>@item.BulguDurumu</td>
                <td>@item.Segment</td>


          @*      <td style="background-color: @(item.KktyeGönderİldİMİ == "No" ? "red" : (item.KktyeGönderİldİMİ == "Yes" ? "GreenBackground" : "inherit"));">
                    @item.KktyeGönderİldİMİ
                </td>




                <td style="background-color: @(item.KktOnayiAlindiMi == "No" ? "red" : (item.KktOnayiAlindiMi == "Yes" ? "green" : "inherit"));">
                    @item.KktOnayiAlindiMi
                </td>*@


                <td>@item.KktyeGönderİldİMİ</td>

                <td>@item.KktOnayiAlindiMi</td>
             
            
                <td>@item.Notlar</td>
                <td>@item.İlgiliAnalist</td>
                <td>@item.MergeDurumuIos</td>
                <td>@item.MergeDurumuAnd</td>
                <td>@item.MergeDurumuBe</td>
                <td>@item.İlgiliIosDeveloper</td>
                <td>@item.İlgiliAndroidDeveloper</td>
                <td>@item.İlgiliBeDeveloper</td>
                <td>@item.BeTaşımaKatmanları</td>
                <td>@item.GeçİşZorunluluğu</td>
                <td>@item.UiApiSenaryoId</td>
                
                <td>
                    <a href="/Home/Edit/@item.satırID" style="color:#e68a06">Edit</a>&nbsp;|&nbsp;
                
                    <a href="#" style="color:#e68a06" onclick="showModal(); document.getElementById('confirmDelete').href='/Home/Delete/@item.satırID'">Delete</a>


                
                </td>
            </tr>
        }


        <script>
            // Define a function to refresh the page
            function refreshPage() {
                location.reload();
            }

            // Set the timeout interval to 10 seconds (in milliseconds)
            const refreshInterval = 7000; // 10 seconds

            // Initialize a timer to track user inactivity
            let inactivityTimer;

             //Reset the inactivity timer whenever there's user interaction
             //  Search görüntülenleri maouse hareket ettiği sürece süre uzayıp görebilir 
            document.addEventListener("mousemove", resetTimer);
            document.addEventListener("keydown", resetTimer);

            // Function to reset the inactivity timer
            function resetTimer() {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(refreshPage, refreshInterval);
            }

            // Start the initial inactivity timer
            resetTimer();
        </script>

    </tbody>
</table>

@*<button class="btn btn-primary" onclick="addShortcut()">Add Shortcut</button>
*@

<script>
    function searchInTable() {
        var searchText = document.getElementById("searchInput").value.toLowerCase();
        var rows = document.getElementsByTagName("tr");

        for (var i = 1; i < rows.length; i++) { // Start from 1 to skip the table header row
            var row = rows[i];
            var cells = row.getElementsByTagName("td");
            var found = false;

            for (var j = 0; j < cells.length; j++) {
                var cell = cells[j];
                if (cell.innerHTML.toLowerCase().includes(searchText)) {
                    found = true;
                    break;
                }
            }

            if (found) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        }
    }

    
</script>
<form method="post" asp-action="ExportToExcel">
    <input type="hidden" name="selectedTakvimId" value="@ViewBag.SelectedTakvimId" />
    <input type="hidden" name="selectedUygulamaAdi" value="@ViewBag.SelectedUygulamaAdi" />
    <button type="submit" class="btn btn-primary" style="background-color: #FFCA4F; color: white;">Export to Excel</button>
</form>

<!-- The Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content center">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 style="color:red">Are you sure</h2>
        <p> you want to delete this item?</p>
        <div class="button-container" >
            <a href="#" class="delete-button" style=" color:#e68a06"" id="confirmDelete">Yes</a>
            <a href="#" class="cancel-button" style="color:#e68a06" onclick="closeModal()">No</a>
        </div>
    </div>
</div>

<script>
    // Show the modal
    function showModal() {
        var modal = document.getElementById("deleteModal");
        modal.style.display = "block";
    }

    // Close the modal
    function closeModal() {
        var modal = document.getElementById("deleteModal");
        modal.style.display = "none";
    }
</script>
<style>
    /* Center the modal */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0, 0, 0, 0.4); /* Black with a transparency */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more or less, depending on screen size */
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
    }

    /* Close button */
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    /* Center the content inside the modal */
    .center {
        text-align: center;
    }

    /* Additional styles for buttons and other elements can be added as needed */
</style>

@*<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.10/signalr.min.js"></script>*@


@*<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/crudhub")
        .build();

    connection.on("ReceiveCrudOperation", (operation, message) => {
        // Handle real-time updates here
        console.log(`${operation}: ${message}`);
    });

    connection.start().catch(err => console.error(err));


</script>*@

@*<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/crudhub")
        .build();

    connection.on("ReceiveCrudOperation", (operation, message) => {
        // Handle real-time updates here
        console.log(`${operation}: ${message}`);
    });

    connection.start()
        .then(() => {
            console.log("SignalR connected successfully.");
        })
        .catch(error => {
            console.error("SignalR connection error: " + error);
        });
</script>*@



@*<script>
    function editVersion(version) {
        $("#editVersionModal input[name='version']").val(version);
        $("#editVersionModal").modal("show");
    }

    function deleteVersion(version) {
        $("#deleteVersionModal input[name='Version']").val(version);
        $("#deleteVersionModal").modal("show");
    }
</script>

*@






@*
    KISA YOLA EKLEME 
<script>
    function addShortcut(takvimId, uygulamaAdi) {
        var shortcutName = prompt("Enter a name for the shortcut:");
        if (shortcutName) {
            // Send the TakvimId, UygulamaAdi, and ShortcutName to the server to save
            $.ajax({
                url: '/Shortcuts/Add', // Replace with your controller action
                method: 'POST',
                data: {
                    TakvimId: takvimId,
                    UygulamaAdi: uygulamaAdi,
                    ShortcutName: shortcutName
                },
                success: function (data) {
                    if (data.success) {
                        // Refresh the shortcuts list or update it as needed
                        // You can also display a success message to the user
                    } else {
                        alert("Failed to save shortcut.");
                    }
                }
            });
        }
    }
</script>
*@

@*<button class="btn btn-primary" id="openSaveModal">Add New Uygulama</button>


<!-- The Modal -->
<div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="saveModalLabel">Add New Uygulama</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Your form goes here -->
                <form id="saveForm">
                    <div class="form-group">
                        <label for="c">Version:</label>
                        <input type="text" class="form-control" id="Version" name="Version">
                    </div>
                    <div class="form-group">
                        <label for="UygulamaAdı">Uygulama Adı:</label>
                        <input type="text" class="form-control" id="UygulamaAdı" name="UygulamaAdı">
                    </div>

                    <div class="form-group">
                        <label for="TakvimId">Takvim Id:</label>
                        <input type="text" class="form-control" id="TakvimId" name="TakvimId">
                    </div>
                    <div class="form-group">
                        <label for="EtliAlanı">Etki Alanı:</label>
                        <input type="text" class="form-control" id="EtliAlanı" name="EtliAlanı">
                    </div>
                    <div class="form-group">
                        <label for="TalepBug">Talep/Bug:</label>
                        <input type="text" class="form-control" id="TalepBug" name="TalepBug">
                    </div>

                    <div class="form-group">
                        <label for="TalepAdi">Talep Adı:</label>
                        <input type="text" class="form-control" id="TalepAdi" name="TalepAdi">
                    </div>
                    <div class="form-group">
                        <label for="BulguDurumu">Bulgu Durumu:</label>
                        <input type="text" class="form-control" id="BulguDurumu" name="BulguDurumu">
                    </div>
                    <div class="form-group">
                        <label for="Segment">Segment:</label>
                        <input type="text" class="form-control" id="Segment" name="Segment">
                    </div>
                    <div class="form-group">
                        <label for="KKTYeGonderilme">KKTYE Gönderildi mi?:</label>
                        <input type="text" class="form-control" id="KKTYeGonderilme" name="KKTYeGonderilme">
                    </div>
                    <div class="form-group">
                        <label for="KKTOnayi">KKTE Onayı Alındı mı?:</label>
                        <input type="text" class="form-control" id="UygulamaAdı" name="UygulamaAdı">
                    </div>
                    <div class="form-group">
                        <label for="Notlar">Notlar:</label>
                        <input type="text" class="form-control" id="Notlar" name="Notlar">
                    </div>
                    <div class="form-group">
                        <label for="Analist">İlgili Analist:</label>
                        <input type="text" class="form-control" id="Analist" name="Analist">
                    </div>
                    <div class="form-group">
                        <label for="mergeIOS">Merge Durumu IOS:</label>
                        <input type="text" class="form-control" id="mergeIOS" name="mergeIOS">
                    </div>
                    <div class="form-group">
                        <label for="mergeAND">Merge Durumu AND:</label>
                        <input type="text" class="form-control" id="mergeAND" name="mergeAND">
                    </div>
                    <div class="form-group">
                        <label for="mergeBE">Merge Durumu BE:</label>
                        <input type="text" class="form-control" id="mergeBE" name="mergeBE">
                    </div>
                    <div class="form-group">
                        <label for="IOSDev">İlgili IOS Developer:</label>
                        <input type="text" class="form-control" id="IOSDev" name="IOSDev">
                    </div>
                    <div class="form-group">
                        <label for="ANDDev">İlgili Android Developer:</label>
                        <input type="text" class="form-control" id="ANDDev" name="ANDDev">
                    </div>
                    <div class="form-group">
                        <label for="BEDev">İlgili BE Developer:</label>
                        <input type="text" class="form-control" id="BEDev" name="BEDev">
                    </div>
                    <div class="form-group">
                        <label for="TasimaKatmanlari">BE Taşıma Katmanları:</label>
                        <input type="text" class="form-control" id="TasimaKatmanlari" name="TasimaKatmanlari">
                    </div>
                    <div class="form-group">
                        <label for="GecisZorunluluğu">Geçiş Zorunluluğu:</label>
                        <input type="text" class="form-control" id="GecisZorunluluğu" name="GecisZorunluluğu">
                    </div>
                    <div class="form-group">
                        <label for="SenaryoID">UI/API Senaryo ID:</label>
                        <input type="int" class="form-control" id="SenaryoID" name="SenaryoID">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                //<button type="button" class="btn btn-primary" id="saveButton">Save</button>
                <button type="submit" class="btn btn-primary" style="background-color: #FFCA4F; color: white; margin-top:0px ;margin-left:0px">Save</button>

            </div>
        </div>
    </div>
</div>
<script>
  $(document).ready(function () {
    // Open the modal when the button is clicked
    $("#openSaveModal").click(function () {
      $("#saveModal").modal("show");
    });

    // Handle form submission
    $("#saveButton").click(function () {
      // Serialize the form data
      var formData = $("#saveForm").serialize();

      // Perform an AJAX POST request to submit the form
      $.ajax({
        url: "/Home/Save", // Replace with your controller action URL
        type: "POST",
        data: formData,
        success: function (result) {
          if (result.success) {
            // Close the modal if the save was successful
            $("#saveModal").modal("hide");
            // Optionally, you can refresh the data table or perform any other actions
            location.reload(); // Example: Refresh the page
          } else {
            // Handle validation errors or other errors if necessary
            alert("Failed to save Uygulama.");
          }
        },
        error: function () {
          // Handle AJAX errors if necessary
          alert("An error occurred while saving Uygulama.");
        }
      });
    });
  });
</script>
*@

